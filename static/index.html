<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>SnapLoad - Video Extractor</title>
</head>
<body>
    <h1>SnapLoad - Video Info Extractor</h1>

    <input type="text" id="videoUrl" placeholder="Enter video URL" style="width: 400px;" />
    <button onclick="analyzeVideo()">Analyze</button>

    <div id="result" style="margin-top: 20px;"></div>

    <script>
        async function analyzeVideo() {
            const urlInput = document.getElementById("videoUrl");
            const url = urlInput.value.trim();
            const resultDiv = document.getElementById("result");
            resultDiv.innerHTML = "Loading...";

            if (!url) {
                resultDiv.innerHTML = "<span style='color:red'>Please enter a video URL.</span>";
                return;
            }

            try {
                const response = await fetch("https://snapload-qg2u.onrender.com/extract-video", {
                    method: "POST",
                    headers: {
                        "Content-Type": "application/json"
                    },
                    body: JSON.stringify({ url }) // اسم المفتاح يجب أن يكون "url" كما في backend
                });

                if (!response.ok) {
                    const errorData = await response.json();
                    throw new Error(errorData.detail || "Unknown error");
                }

                const data = await response.json();

                // عرض المعلومات الأساسية
                let html = `<h2>${data.title}</h2>`;
                html += `<img src="${data.thumbnail}" alt="Thumbnail" width="320" /><br/>`;
                html += `<p>Duration: ${data.duration} seconds</p>`;
                html += "<h3>Available Formats:</h3><ul>";

                data.formats.forEach(format => {
                    html += `<li>Format ID: ${format.format_id} | Extension: ${format.ext} | Resolution: ${format.resolution || 'N/A'} | Size: ${format.filesize ? (format.filesize / (1024*1024)).toFixed(2) + ' MB' : 'Unknown'}</li>`;
                });
                html += "</ul>";

                resultDiv.innerHTML = html;

            } catch (error) {
                resultDiv.innerHTML = `<span style="color:red">Error: ${error.message}</span>`;
            }
        }
    </script>
</body>
</html>
